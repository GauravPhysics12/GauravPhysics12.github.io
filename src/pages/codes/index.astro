---
import { Container } from '@components/odyssey-theme';
import Layout from '../../layouts/Page.astro';
import { getCollection } from 'astro:content';

// This correctly finds your posts in src/content/codes/
const codePosts = await getCollection('codes');

const sortedPosts = codePosts.sort(
  (a, b) => new Date(b.data.publishDate).valueOf() - new Date(a.data.publishDate).valueOf()
);
---

<Layout>
  <Container>
    <div class="page-hero">
      <h1>Coding & Software</h1>
      <p>From numerical simulations to introductory scripts for beginners.</p>
    </div>

    <section class="posts-list-section">
      <div class="posts-grid">
        {sortedPosts.map(post => (
          <a href={`/codes/${post.slug}`} class="post-card">
            {post.data.featuredImage && (
              <img
                src={post.data.featuredImage}
                alt={post.data.title}
                class="post-card__image"
              />
            )}
            <div class="post-card__content">
              <h3>{post.data.title}</h3>
              <p>{post.data.excerpt}</p>
            </div>
          </a>
        ))}
      </div>
    </section>
  </Container>

  <div class="feynman-quote">
    <p>"It doesn't matter how beautiful your theory is, it doesn't matter how smart you are. If it doesn't agree with experiment, it's wrong."</p>
    <p>â€“ Richard Feynman</p>
  </div>
</Layout>

<style>
  .page-hero { 
    padding: 3rem 0; 
    text-align: center; 
  }
  .page-hero h1 { 
    font-size: 3.5rem; 
    margin-bottom: 1rem; 
  }
  .posts-list-section { 
    margin: var(--section-margin) auto; 
  }
  .posts-grid { 
    display: grid; 
    grid-template-columns: 1fr; 
    gap: 2.5rem; 
  }
  @media (min-width: 768px) { 
    .posts-grid { 
      grid-template-columns: repeat(2, 1fr); 
    } 
  }
  .post-card { 
    display: block; 
    background-color: var(--theme-bg-offset); 
    border-radius: 8px; 
    overflow: hidden; 
    text-decoration: none; 
    color: var(--theme-text); 
    transition: transform 0.2s ease; 
  }
  .post-card:hover { 
    transform: translateY(-5px); 
  }
  .post-card__image { 
    width: 100%; 
    height: 220px; 
    object-fit: cover; 
  }
  .post-card__content { 
    padding: 1.5rem; 
  }
  .post-card__content h3 { 
    margin: 0 0 0.75rem 0; 
    font-size: 1.6rem; 
  }
  .post-card__content p { 
    margin: 0; 
    color: var(--theme-text-offset); 
  }
  
  /* Feynman quote styling */
  .feynman-quote {
    margin: 4rem auto;
    padding: 0 1rem;
    max-width: 700px;
    font-style: italic;
    text-align: center;
    color: var(--theme-text);
    font-size: 1.2rem;
    line-height: 1.7;
  }
  .feynman-quote p:last-child {
    font-style: normal;
    font-weight: 500;
    margin-top: 1.5rem;
    color: var(--theme-text-offset);
  }
  /* --- FIX 2: FEATURED IMAGE ON INDEX PAGE --- */
  .post-card__image { 
    width: 100%; 
    /* Use min-height to reserve space, but let auto height take over */
    min-height: 220px; 
    height: auto; 
    /* Change from 'cover' to 'contain' to ensure the entire image is visible */
    object-fit: contain; 
    /* Set a background to fill the empty space left by 'contain' */
    background-color: var(--theme-bg-offset);
    padding: 1rem; /* Optional: Add some padding for better spacing */
  }

  .post-card__content { padding: 1.5rem; }
  .post-card__content h3 { margin: 0 0 0.75rem 0; font-size: 1.6rem; }
  .post-card__content p { margin: 0; color: var(--theme-text-offset); }
</style>